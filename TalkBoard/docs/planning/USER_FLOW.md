# 🧭 사용자 플로우 및 기능 흐름도

## 📱 주요 사용자 플로우

### 1. 회원가입 및 로그인

```
시작
  ↓
회원가입 화면
  ↓
이메일/비밀번호 입력
  ↓
Firebase Authentication 가입
  ↓
사용자 정보 Firestore 저장
  ↓
홈 화면 이동
```

### 2. 추모관 생성

```
홈 화면
  ↓
"추모관 만들기" 버튼 클릭
  ↓
추모관 생성 화면 (Step 1)
  ↓
기본 정보 입력 (이름, 생애)
  ↓
Step 2: 사진 업로드
  ↓
Step 3: 동영상 추가
  ↓
Step 4: 편지 작성
  ↓
Step 5: 설정 (기념일, 공개/비공개)
  ↓
저장 버튼 클릭
  ↓
Firestore에 저장
  ↓
Storage에 파일 업로드
  ↓
추모관 상세 화면 이동
```

### 3. 추모관 조회

```
홈 화면 또는 추모관 목록
  ↓
추모관 카드 클릭
  ↓
추모관 상세 화면
  ↓
방문 기록 추가 (하루 1회)
  ↓
콘텐츠 조회 (사진, 영상, 편지)
  ↓
댓글 작성 (선택)
  ↓
추모금 전달 (선택)
```

### 4. 댓글 작성

```
추모관 상세 화면
  ↓
댓글 작성창에 텍스트 입력
  ↓
전송 버튼 클릭
  ↓
Firestore에 댓글 저장
  ↓
댓글 리스트에 추가
  ↓
작성자에게 알림 (선택)
```

### 5. 기도 요청

```
기도 요청 화면
  ↓
"기도 요청 작성" 버튼 클릭
  ↓
제목, 내용 입력
  ↓
저장 버튼 클릭
  ↓
Firestore에 저장
  ↓
기도 요청 리스트에 표시
  ↓
다른 사용자 "함께 기도" 클릭
  ↓
기도 카운트 증가
  ↓
응답 댓글 작성 (선택)
```

### 6. 추모금 전달

```
추모관 상세 화면
  ↓
"추모금 전달" 버튼 클릭
  ↓
추모금 전달 모달 열기
  ↓
금액 입력
  ↓
수수료 및 유지비 안내 확인
  ↓
결제 수단 선택
  ↓
결제 정보 입력
  ↓
결제 승인
  ↓
PG사 결제 API 호출
  ↓
결제 완료
  ↓
수수료 및 유지비 차감
  ↓
Firestore에 결제 기록 저장
  ↓
수령자에게 알림
  ↓
모달 닫기
```

### 7. 프리미엄 구독

```
마이페이지
  ↓
"프리미엄 구독" 버튼 클릭
  ↓
구독 플랜 선택 (월간/연간)
  ↓
결제 수단 선택
  ↓
결제 정보 입력
  ↓
결제 승인
  ↓
인앱 결제 또는 PG사 결제
  ↓
결제 완료
  ↓
Firestore에 구독 정보 저장
  ↓
프리미엄 기능 활성화
```

### 8. 감정 공유 게시판

```
감정 공유 게시판 화면
  ↓
글 리스트 조회
  ↓
글 카드 클릭
  ↓
글 상세 화면
  ↓
좋아요 클릭 (선택)
  ↓
댓글 작성 (선택)
  ↓
또는 "글 작성" 버튼 클릭
  ↓
제목, 내용 입력
  ↓
저장 버튼 클릭
  ↓
Firestore에 저장
  ↓
글 리스트에 추가
```

## 🔄 기능별 상세 흐름

### 방문 기록 시스템

```
사용자가 추모관 상세 화면 진입
  ↓
오늘 날짜로 방문 기록 조회
  ↓
오늘 방문 기록이 있는가?
  ├─ Yes → 방문 카운트 증가 없음
  └─ No → 방문 기록 생성
         ↓
         방문 카운트 +1
         ↓
         Firestore에 방문 기록 저장
```

### 기념일 알림 시스템

```
Cloud Functions 스케줄러 (매일 00:00 실행)
  ↓
오늘 날짜와 일치하는 기념일 조회
  ↓
기념일이 있는 추모관 목록 가져오기
  ↓
각 추모관의 생성자에게 푸시 알림 전송
  ↓
알림 내용: "오늘은 [고인 이름]님의 [기념일]입니다"
```

### 추모금 수령 프로세스

```
수령자가 마이페이지에서 "추모금 내역" 조회
  ↓
수령 가능한 추모금 목록 표시
  ↓
"출금 요청" 버튼 클릭
  ↓
계좌 정보 입력
  ↓
출금 요청 승인
  ↓
Cloud Functions에서 출금 처리
  ↓
계좌로 이체
  ↓
출금 완료 알림
```

### 이미지 업로드 프로세스

```
사용자가 "사진 업로드" 버튼 클릭
  ↓
이미지 피커 열기
  ↓
이미지 선택
  ↓
이미지 리사이징 (선택)
  ↓
Firebase Storage에 업로드
  ↓
업로드 진행률 표시
  ↓
업로드 완료
  ↓
다운로드 URL 받기
  ↓
Firestore에 URL 저장
  ↓
미리보기에 표시
```

### 동영상 재생 프로세스

```
추모관 상세 화면에서 동영상 섹션
  ↓
동영상 타입 확인
  ├─ YouTube 링크 → YouTube 플레이어 열기
  └─ 업로드된 영상 → Video Player 위젯 사용
     ↓
     썸네일 표시
     ↓
     재생 버튼 클릭
     ↓
     동영상 재생
```

### 음성 편지 녹음 및 재생

```
편지 작성 화면에서 "음성 편지" 선택
  ↓
녹음 버튼 클릭
  ↓
마이크 권한 확인
  ↓
녹음 시작
  ↓
녹음 중... (진행 바 표시)
  ↓
정지 버튼 클릭
  ↓
녹음 완료
  ↓
재생 버튼으로 확인
  ↓
저장 버튼 클릭
  ↓
오디오 파일 Firebase Storage에 업로드
  ↓
Firestore에 오디오 URL 저장
```

## 🎯 사용자 시나리오

### 시나리오 1: 추모관 생성 및 공유

1. 사용자 A가 앱에 가입
2. 추모관 생성 (고인: 할아버지)
3. 사진 5장 업로드
4. 편지 작성 (텍스트)
5. 공개 설정
6. 저장 완료
7. 친구들에게 링크 공유
8. 친구들이 추모관 방문
9. 댓글 작성
10. 추모금 전달

### 시나리오 2: 기념일 알림 및 추모

1. 사용자 B가 추모관 생성 (고인: 어머니)
2. 기념일 설정 (생일: 3월 15일)
3. 3월 15일 오전 9시 푸시 알림 수신
4. "추모하러 가기" 클릭
5. 추모관 상세 화면 이동
6. 편지 다시 읽기
7. 댓글 작성
8. 기도 요청 작성

### 시나리오 3: 프리미엄 구독 및 활용

1. 사용자 C가 무료 추모관 생성
2. 사진 5장 업로드 완료
3. 추가 사진 업로드 시도
4. "프리미엄 구독 필요" 메시지 표시
5. 프리미엄 구독 페이지 이동
6. 월간 구독 선택
7. 결제 완료
8. 무제한 사진 업로드 가능
9. 커스텀 배경 적용

### 시나리오 4: 감정 공유 및 위로

1. 사용자 D가 감정 공유 게시판 방문
2. 다른 사용자의 글 읽기
3. 공감하여 좋아요 클릭
4. 위로 댓글 작성
5. 자신의 감정 글 작성
6. 다른 사용자들의 댓글 확인
7. 위로 받음

## 📊 상태 다이어그램

### 추모관 상태

```
[생성 중] → [저장 완료] → [공개] / [비공개]
                ↓
            [수정 중]
                ↓
            [수정 완료]
                ↓
            [삭제됨] (소프트 삭제)
```

### 결제 상태

```
[결제 요청] → [결제 중] → [결제 완료] → [수령 완료]
                ↓
            [결제 실패]
```

### 구독 상태

```
[구독 없음] → [구독 중] → [만료됨] → [구독 없음]
                              ↓
                        [연장됨]
```

