# 🆕 새 Firebase 프로젝트 색인 추가 가이드

## 📸 참고: 현재 설정된 색인들

이미 보신 이미지처럼, 다음 3개의 색인이 필요합니다:

### 색인 목록

| 번호 | 컬렉션 | 필드 구성 | 용도 |
|------|--------|-----------|------|
| 1 | `comments` | `postId ↑`, `isDeleted ↑`, `__name__ ↑` | 댓글 필터링 및 조회 |
| 2 | `comments` | `postId ↑`, `createdAt ↑`, `__name__ ↑` | 댓글 시간순 정렬 |
| 3 | `posts` | `isDeleted ↑`, `createdAt ↓`, `__name__ ↑` | 게시글 목록 조회 |

## 🚀 단계별 생성 방법

### 1단계: Firebase Console 접속

1. https://console.firebase.google.com 접속
2. **"톡보드"** 프로젝트 선택 (최근 생성한 새 프로젝트)
3. 왼쪽 메뉴에서 **"Cloud Firestore"** → **"데이터베이스"** 클릭
4. 상단 탭에서 **"색인"** 클릭

### 2단계: 첫 번째 색인 생성 (comments - postId, isDeleted)

1. 오른쪽 상단의 파란색 **"색인 추가"** 버튼 클릭
2. **"복합"** 버튼이 선택되어 있는지 확인 (기본값)
3. 다음 정보 입력:
   ```
   컬렉션 ID: comments
   
   필드:
   ┌─────────────┬──────────────┐
   │ 필드 이름   │ 정렬 순서    │
   ├─────────────┼──────────────┤
   │ postId      │ 오름차순 (↑) │
   │ isDeleted   │ 오름차순 (↑) │
   └─────────────┴──────────────┘
   ```
   - `__name__`은 자동으로 추가됩니다
4. **"만들기"** 버튼 클릭

### 3단계: 두 번째 색인 생성 (comments - postId, createdAt)

1. 다시 **"색인 추가"** 버튼 클릭
2. 다음 정보 입력:
   ```
   컬렉션 ID: comments
   
   필드:
   ┌─────────────┬──────────────┐
   │ 필드 이름   │ 정렬 순서    │
   ├─────────────┼──────────────┤
   │ postId      │ 오름차순 (↑) │
   │ createdAt   │ 오름차순 (↑) │
   └─────────────┴──────────────┘
   ```
3. **"만들기"** 버튼 클릭

### 4단계: 세 번째 색인 생성 (posts - isDeleted, createdAt)

1. 다시 **"색인 추가"** 버튼 클릭
2. 다음 정보 입력:
   ```
   컬렉션 ID: posts
   
   필드:
   ┌─────────────┬──────────────┐
   │ 필드 이름   │ 정렬 순서    │
   ├─────────────┼──────────────┤
   │ isDeleted   │ 오름차순 (↑) │
   │ createdAt   │ 내림차순 (↓) │
   └─────────────┴──────────────┘
   ```
   ⚠️ **주의**: `createdAt`은 **내림차순 (↓)**으로 설정하세요!
3. **"만들기"** 버튼 클릭

## ⏱️ 대기 시간

- 각 색인 생성에 **1-5분** 소요됩니다
- 상태가 **"사용 설정됨"** (또는 "Enabled")가 되면 완료입니다

## ✅ 완료 확인

생성 완료 후 "색인" 탭에서 다음 3개가 모두 보여야 합니다:

```
✅ comments: postId ↑, isDeleted ↑, __name__ ↑ → 상태: 사용 설정됨
✅ comments: postId ↑, createdAt ↑, __name__ ↑ → 상태: 사용 설정됨
✅ posts: isDeleted ↑, createdAt ↓, __name__ ↑ → 상태: 사용 설정됨
```

## 🧪 테스트

색인 생성이 완료되면 앱을 실행하여 테스트하세요:

```bash
cd /Users/haemin/Documents/GitHub/project/TalkBoard
flutter run
```

게시글 목록과 댓글이 정상적으로 표시되는지 확인하세요!

## 🚨 문제 해결

### 색인이 생성되지 않아요
- 각 색인 생성 시 **"만들기"** 버튼을 눌렀는지 확인
- Firebase Console에서 "색인" 탭의 상태를 확인

### 색인 생성 중 오류 발생
- 색인 생성 폼에서 필드 이름을 정확히 입력했는지 확인 (`postId`, `isDeleted`, `createdAt`)
- 대소문자 주의: `postId` (소문자 p, 대문자 I)

### 앱에서 여전히 "색인이 필요합니다" 오류 발생
- 모든 색인의 상태가 **"사용 설정됨"**인지 확인
- 앱을 완전히 종료 후 다시 실행 (`flutter run`)
- Firebase Console 페이지 새로고침

## 📚 관련 문서

- [Firebase 재연결 가이드](FIREBASE_RECONNECT.md)
- [Firestore 보안 규칙](FIRESTORE_SECURITY_RULES.md)

