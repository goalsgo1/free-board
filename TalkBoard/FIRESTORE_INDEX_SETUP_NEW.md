# 새 Firebase 프로젝트 색인 설정 가이드

## 📋 필요한 색인 목록

새 "톡보드" Firebase 프로젝트에 다음 3개의 복합 색인을 생성해야 합니다:

### 1. 게시글 목록 조회용 (posts)
- **컬렉션 ID**: `posts`
- **필드**: 
  - `isDeleted` (오름차순 ↑)
  - `createdAt` (내림차순 ↓)
  - `__name__` (오름차순 ↑) - 자동 추가됨

### 2. 댓글 목록 조회용 #1 (comments)
- **컬렉션 ID**: `comments`
- **필드**:
  - `postId` (오름차순 ↑)
  - `isDeleted` (오름차순 ↑)
  - `__name__` (오름차순 ↑) - 자동 추가됨

### 3. 댓글 목록 조회용 #2 (comments)
- **컬렉션 ID**: `comments`
- **필드**:
  - `postId` (오름차순 ↑)
  - `createdAt` (오름차순 ↑)
  - `__name__` (오름차순 ↑) - 자동 추가됨

## 🔧 색인 생성 방법

### 단계 1: Firebase Console 접속

1. https://console.firebase.google.com 접속
2. **"톡보드"** 프로젝트 선택
3. 왼쪽 메뉴에서 **"Firestore Database"** 클릭
4. 상단 탭에서 **"색인"** 클릭

### 단계 2: 첫 번째 색인 생성 (posts)

1. **"색인 추가"** 버튼 클릭 (오른쪽 상단 파란색 버튼)
2. **"복합"** 탭이 선택되어 있는지 확인
3. 설정 입력:
   - **컬렉션 ID**: `posts` 입력
   - **필드 추가**:
     - `isDeleted` → 정렬: **오름차순** (↑)
     - `createdAt` → 정렬: **내림차순** (↓)
   - `__name__`은 자동으로 추가됩니다
4. **"만들기"** 버튼 클릭

### 단계 3: 두 번째 색인 생성 (comments - postId, isDeleted)

1. **"색인 추가"** 버튼 클릭
2. 설정 입력:
   - **컬렉션 ID**: `comments` 입력
   - **필드 추가**:
     - `postId` → 정렬: **오름차순** (↑)
     - `isDeleted` → 정렬: **오름차순** (↑)
3. **"만들기"** 버튼 클릭

### 단계 4: 세 번째 색인 생성 (comments - postId, createdAt)

1. **"색인 추가"** 버튼 클릭
2. 설정 입력:
   - **컬렉션 ID**: `comments` 입력
   - **필드 추가**:
     - `postId` → 정렬: **오름차순** (↑)
     - `createdAt` → 정렬: **오름차순** (↑)
3. **"만들기"** 버튼 클릭

## ⏱️ 색인 생성 시간

- 각 색인 생성에 **1-5분** 정도 소요됩니다
- 상태가 **"사용 설정됨"** 또는 **"Enabled"**가 되면 완료입니다

## ✅ 생성 완료 확인

색인 생성이 완료되면:

1. **"색인"** 탭에서 다음 3개의 색인이 모두 표시되는지 확인:
   - ✅ `posts`: `isDeleted ↑`, `createdAt ↓`
   - ✅ `comments`: `postId ↑`, `isDeleted ↑`
   - ✅ `comments`: `postId ↑`, `createdAt ↑`

2. 각 색인의 **상태**가 **"사용 설정됨"**인지 확인

3. 앱 실행하여 테스트:
   ```bash
   flutter run
   ```

## 🚨 주의사항

### 색인 생성 중
- 색인이 생성되는 동안에는 해당 쿼리를 사용할 수 없습니다
- 색인 생성이 완료될 때까지 대기하세요

### 오류 발생 시
만약 앱 실행 시 "색인이 필요합니다" 오류가 발생하면:
1. Firebase Console → Firestore Database → 색인 탭 확인
2. 필요한 색인이 모두 생성되었는지 확인
3. 색인 상태가 "사용 설정됨"인지 확인

## 📸 참고 이미지

생성 완료 후 Firebase Console의 "색인" 탭에는 다음과 같이 표시됩니다:

```
┌─────────────┬────────────────────────────────┬─────────────┬──────────────┬──────────────┐
│ 컬렉션 ID   │ 색인이 지정된 필드              │ 쿼리 범위   │ 색인 ID     │ 상태        │
├─────────────┼────────────────────────────────┼─────────────┼──────────────┼──────────────┤
│ comments    │ postId ↑, isDeleted ↑,         │ 컬렉션      │ CICAgJim... │ 사용 설정됨 │
│             │ __name__ ↑                      │             │              │              │
├─────────────┼────────────────────────────────┼─────────────┼──────────────┼──────────────┤
│ comments    │ postId ↑, createdAt ↑,         │ 컬렉션      │ CICAgOjX... │ 사용 설정됨 │
│             │ __name__ ↑                      │             │              │              │
├─────────────┼────────────────────────────────┼─────────────┼──────────────┼──────────────┤
│ posts       │ isDeleted ↑, createdAt ↓,       │ 컬렉션      │ CICAgJiU... │ 사용 설정됨 │
│             │ __name__ ↑                      │             │              │              │
└─────────────┴────────────────────────────────┴─────────────┴──────────────┴──────────────┘
```

## 🔗 관련 문서

- [Firebase 재연결 가이드](FIREBASE_RECONNECT.md)
- [Firestore 보안 규칙](FIRESTORE_SECURITY_RULES.md)

